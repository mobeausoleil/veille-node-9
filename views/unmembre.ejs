<!DOCTYPE html>
<html lang="fr">
<meta charset="utf-8">
<%- include('composants/head') %>
<body>
<%- include('composants/menu') %>
<%- include('composants/formulaire') %>
<div id="global">
	<h1><%= __("unMemb") %><%= unmembre[0].prenom %> <%= unmembre[0].nom %></h1>
	<table class="tableau unmembre">
		<tr>
			<th>_id</th>
			<th><%= __("nom")  %></th>
			<th><%= __("prenom")  %></th>
			<th><%= __("telephone")  %></th>
			<th><%= __("courriel")  %></th>
		</tr>
		<tr>
			<% for (p in unmembre[0]) { %>
	 			<td contenteditable='true'><%= unmembre[0][p] %></td>
	 		<% } %>
	 		<td><a class="sauver" href="#"><%= __("modifier")  %></a></td>
		</tr>
	</table>
	<button id='testAJAX'>test AJAX</button>
</div>
<%- include('composants/footer') %>
<script type="text/javascript">

/////////////////////////////////////////////////////////////////////////////////////// Modifier Ajax

	let elmBouton = document.getElementById('testAJAX');
	elmBouton.addEventListener('click', ()=>{
		console.log('ok');
		xhr = new XMLHttpRequest();
		xhr.open('POST', "/ajax_modifier", true);
		data = {
			"nom" : "AAAA",
			"prenom" : "BBBB",
			"telephone" : "CCCC",
			"courriel" : "DDDD",
			"_id" : "5a998d5fcb26180cc836593a"
		}
		console.log(data);
		sData = JSON.stringify(data);
		xhr.setRequestHeader('Content-type', 'application/json');
		xhr.send(sData);
		xhr.addEventListener("readystatechange", traiterRequest, false);
	});

	function traiterRequest(e){
		console.log("xhr.readyState = " + xhr.readyState);
		console.log("xhr.status = " + xhr.status);
		if(xhr.readyState == 4 && xhr.status == 200);
		{
			console.log('ajax fonctionne');
			let  maReponse = JSON.parse(xhr.responseText);
			console.log(xhr.responseText);
			console.log(maReponse._id);
		}
	}

//////////////////////////////////////////////////////////////////////////////////////	Modifier

	let elmSauver = document.querySelectorAll('.sauver')
	for (elm of elmSauver){
		elm.addEventListener('click', function(){
			let laLigne = this.parentNode.parentNode;
			let id = laLigne.children[0].innerHTML;
			let nom = laLigne.children[1].innerHTML;
			let prenom = laLigne.children[2].innerHTML;
			let telephone = laLigne.children[3].innerHTML;
			let courriel = laLigne.children[4].innerHTML;

			let elmForm = document.getElementById('mon_formulaire');
			let elmInput = elmForm.querySelectorAll('input');
			elmInput[0].value = id;
			elmInput[1].value = nom;
			elmInput[2].value = prenom;
			elmInput[3].value = telephone;
			elmInput[4].value = courriel;

			elmForm.submit();
		})
	} 
</script>
</body>
</html>